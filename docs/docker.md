# Docker и контейнеризация CI/CD Demo Project

## Назначение Docker в проекте

Docker используется для упаковки backend-приложения
в воспроизводимый и переносимый контейнер.

Контейнеризация решает следующие задачи:

- гарантирует одинаковую среду выполнения
- упрощает деплой в облако
- изолирует зависимости приложения
- позволяет воспроизводить окружение локально и в CI

Docker является ключевым элементом CI/CD пайплайна.

---

## Что контейнеризируется

В текущей версии проекта контейнеризируется **только backend**.

В контейнер входят:

- Flask-приложение
- Python-зависимости из `requirements.txt`
- WSGI-сервер Gunicorn

Frontend и документация деплоятся отдельно.

---

## Структура backend для Docker

backend/

├── app.py

├── requirements.txt

└── Dockerfile

---

## Dockerfile

Dockerfile расположен по пути:

backend/Dockerfile

Он описывает пошаговую сборку backend-контейнера.

---

## Основные шаги Dockerfile

### Базовый образ

Используется официальный образ Python:

- версия: `3.10`
- тип: `slim`

Причины выбора:

- официальная поддержка
- минимальный размер
- стабильность для production

---

### Рабочая директория

В контейнере используется директория:

/app

Используется флаг `--no-cache-dir`
для уменьшения размера итогового образа.

---

### Копирование исходного кода

В контейнер копируется весь backend-код,
включая `app.py`.

---

### Открытие порта

Контейнер объявляет порт:

10000

Этот порт используется:

- Flask-приложением
- Render Web Service

---

### Запуск приложения

Для запуска используется Gunicorn:

- production-ready WSGI сервер
- лучше подходит для нагрузки, чем Flask dev server

---

## Запуск backend без Docker

Для локальной разработки backend можно запускать напрямую:

```bash
python backend/app.py
```

Backend будет доступен по адресу:

```!
http://localhost:10000
```

## Локальная сборка Docker-образа

Для сборки Docker-образа локально:

```bash
docker build -t myapp-backend -f backend/Dockerfile backend
```

## Запуск Docker-контейнера локально

```bash
docker run -p 10000:10000 myapp-backend
```

После запуска backend будет доступен по адресу: 

```!
http://localhost:10000
```

## Docker в CI/CD

Docker используется в GitHub Actions для:

сборки production-образа

тегирования образов

публикации образов в Docker Hub

Docker-образ является основным артефактом,
который деплоится в Render.

## Docker Registry

Для хранения образов используется Docker Hub.

Образы публикуются автоматически из CI.

## Теги Docker-образов

Используются следующие теги:

| Тег           | Назначение                  |
|---------------|-----------------------------|
| `latest`      | Актуальная версия из `main` |
| `vX.Y.Z`      | Релизные версии             |
| `sha-xxxxxxx` | Сборки по commit hash       |

## Связь Docker и Render

Render:

не собирает код напрямую

подтягивает готовый Docker-образ

перезапускает сервис при новом образе

Docker выступает связующим звеном
между CI и production-окружением.

## Роль документации

Docker-документация необходима для:

понимания процесса сборки

поддержки CI/CD

онбординга новых участников команды

Любое изменение Dockerfile
должно сопровождаться обновлением docs/docker.md.

## Возможные улучшения

multi-stage builds

уменьшение размера образа

добавление non-root пользователя

security scanning образов
